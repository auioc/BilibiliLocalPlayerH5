<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
        <link rel="stylesheet" href="player.css" />
        <link rel="stylesheet" href="lib/CommentCoreLibrary.css" />
        <!--allcss-->
    </head>
    <body>
        <table id="start-panel">
            <tbody>
                <tr>
                    <th colspan="2">
                        BilibiliLocalPlayerH5
                        <div id="version">
                            <a href="aio.html">AIO</a>&nbsp;&middot;&nbsp;
                            <a href="https://github.com/auioc/BilibiliLocalPlayerH5">GitHub</a>&nbsp;&middot;&nbsp;
                            {version}
                        </div>
                    </th>
                </tr>
                <tr>
                    <td><label for="video-file">Video:</label></td>
                    <td>
                        <input id="video-file" type="file" accept="video/mp4,.flv,.mkv" style="width: 100%" />
                    </td>
                </tr>
                <tr>
                    <td>Last:</td>
                    <td>
                        <span id="last-video-file"> <i>None</i> </span>
                    </td>
                </tr>
                <tr>
                    <td><label for="danmaku-file">Danmaku:</label></td>
                    <td>
                        <input id="danmaku-file" type="file" accept=".xml" style="width: 100%" />
                    </td>
                </tr>
                <tr>
                    <td>Time Offset:</td>
                    <td>
                        <input id="danmaku-time-offset" type="number" value="0" />
                    </td>
                </tr>
                <tr>
                    <td>Size Offset:</td>
                    <td><input id="danmaku-size-offset" type="number" value="-3" /></td>
                </tr>
                <tr>
                    <td><label for="subtitle-file">Subtitle:</label></td>
                    <td>
                        <input id="subtitle-file" type="file" accept=".ass" style="width: 100%" />
                    </td>
                </tr>
                <tr>
                    <td>Auto Play:</td>
                    <td><input id="auto-play" type="checkbox" /></td>
                </tr>
                <tr>
                    <td>Muted:</td>
                    <td><input id="muted" type="checkbox" /></td>
                </tr>
                <tr>
                    <td>Fullscreen:</td>
                    <td><input id="fullscreen" type="checkbox" /></td>
                </tr>
                <tr class="center">
                    <td colspan="2">
                        <button id="load-button" onclick="load()">Load</button>
                    </td>
                </tr>
            </tbody>
        </table>
        <div id="player" style="display: none"></div>
        <script src="player.js"></script>
        <!--playerjs-->
        <script>
            window.__title__ = 'BilibiliLocalPlayerH5';
            document.title = window.__title__;
            function id(id) {
                return document.getElementById(id);
            }
            (function () {
                const lastVideoFile = window.localStorage.getItem('lastVideoFile');
                if (lastVideoFile) {
                    id('last-video-file').textContent = lastVideoFile;
                }
            })();
            function load() {
                const video = id('video-file').files[0];
                if (!video) return;
                const videoUrl = URL.createObjectURL(video);
                window.localStorage.setItem('lastVideoFile', video.name);

                const danmaku = id('danmaku-file').files[0];
                const danmakuUrl = danmaku ? URL.createObjectURL(danmaku) : null;

                const subtitle = id('subtitle-file').files[0];
                const subtitleUrl = subtitle ? URL.createObjectURL(subtitle) : null;

                const player = new Player(
                    id('player'),
                    __player_metadata__,
                    video.name,
                    videoUrl,
                    danmakuUrl,
                    subtitleUrl,
                    {
                        autoPlay: id('auto-play').checked,
                        fullscreen: id('fullscreen').checked,
                        muted: id('muted').checked,
                        danmakuTimeOffset: parseFloat(id('danmaku-time-offset').value),
                        danmakuSizeOffset: parseInt(id('danmaku-size-offset').value),
                    }
                );
                window.player = player;
                id('start-panel').remove();
                id('player').removeAttribute('style');
                document.title = `${video.name} | ${__title__}`;
            }
        </script>
    </body>
</html>
